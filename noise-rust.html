<meta charset="utf-8">

<pre id="portrait"></pre>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/p5.min.js"></script>


<style>
    body {
        cursor: none;
        margin: 0;
        overflow: hidden;
        cursor: default;
        user-select: none;
    }
    #portrait {
        font-family: monospace;
        line-height: .65;
	    /*font-weight: lighter;*/
        font-size: 14px;
    }
</style>

<script>
    import {set_text, real_text} from './dist/noise_bg.72b12541.wasm'
    let {millis} = p5.prototype


    const newsAPIKey = 'cadf03152b7a4215896a1082e2025109'



    /**
     * Fetch a news article and give it to Rust for initialization
     */
    fetch(`https://newsapi.org/v2/top-headlines?country=nl&apiKey=cadf03152b7a4215896a1082e2025109`).then(response => {
        response.json().then(({articles}) => {
            let aggregatedArticles = ""
            for (const article of shuffleArray(articles.slice(0, 3))) {
                aggregatedArticles += ` ${article.title} ------ `
            }

            set_text(aggregatedArticles)

            new p5();
            let $portrait = document.querySelector('#portrait')
            setInterval(() => {
                $portrait.innerHTML = real_text(innerWidth, innerHeight, millis())
            }, 16)
        })
    })



    /**
     * Utils
     */
    function shuffleArray(a) {
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

</script>